---
title: "Census Data for Final Project"
author: "Kylie Wheelock Riley"
date: "2/27/2021"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidycensus)
library(tidyverse)
library(dplyr)

census_api_key("545c7215e59e244a022aa2f8ba7c4fd66ab3649a")
```

Getting the population for each CA county from 2010 census
```{r County Population 2010}
county_pop = get_decennial(geography = "county",
                           variables = "P001001",
                           state = "CA"
                           ) %>% 
             select(-GEOID, -variable) %>% ##remove geoid and variable to prep for join
                  rename(cnty_pop = value) 
county_pop %>%
  ggplot(aes(x = cnty_pop, y = reorder(NAME, cnty_pop))) + 
  geom_point()
 
```

Los Angeles county is the most populous county in California with just under 10 million people, San Diego and Orange County come in second and third, respectively, with around 3 million each. Alpine County is the least populous county. 



Calculating the percent urban and percent rural housing from each CA county from 2010 census data 
```{r Land Use}

##Search for land use/ urban rural vars by pulling codebook for census vars
#cdbk2010 = load_variables(2010, "sf1", cache = TRUE)

#View(cdbk2010)
#^^not running when knitting 

##Create a list of the relevant urban/ rural vars
urbanvars = c("H001001", "H002002", "H002005")

##Pull urban/ rural values, pivot to wide format, and rename census vars so they are meaningful
urban_housing = 
  get_decennial(
    geography = "county",
    variables = urbanvars,
    state = "CA"
    ) %>% 
  pivot_wider(
    names_from = "variable", 
    values_from = "value"
    ) %>% 
  dplyr::rename(
        tot_housing = H001001,
        urban_hous =  H002002, 
        rural_hous = H002005 
        ) 
  
##calculate % rural and % urban vars
urban_housing = mutate(urban_housing, 
         pct_urb = urban_hous / tot_housing,
         pct_rural = rural_hous / tot_housing, 
         pct_urb = round(pct_urb, 2), 
         pct_rural = round(pct_rural,2)
         )
  
##plot % urban
urban_housing %>%
  ggplot(aes(x = pct_urb, y = reorder(NAME, pct_urb))) + 
  geom_point()

##plot % rural
urban_housing %>%
  ggplot(aes(x = pct_rural, y = reorder(NAME, pct_rural))) + 
  geom_point()
```

Perecent urban and % rural are perfect invesrses, can just use 1 in analysis. 



Viewing household income from acs from 2006-2010. 
```{r Household Income}
household_income = get_acs(geography = "county",
                           variables = "B19013_001",
                           state = "CA",
                           year = 2010
                           ) %>% 
                  select(-GEOID, -variable) %>% 
                  rename(hshld_income = estimate)

household_income %>%
  ggplot(aes(x = hshld_income, y = reorder(NAME, hshld_income))) + 
  geom_point()
```

Creating census dataset with all relevant variables 
```{r Joinind data}
census_data = left_join(urban_housing, household_income, by = "NAME")

census_data = left_join(census_data, county_pop, by = "NAME") %>% 
  select(GEOID, NAME, cnty_pop, hshld_income, moe, pct_urb, everything())
 

```

